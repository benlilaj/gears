<html><head><title>Gears Drag and Drop</title></head>
<body>
<div id="dropZone" style="background-color: yellow; width:20em; height:15em">
<ol>
<li>Drag some files from the desktop.</li>
<li>Drop them on this DIV.</li>
<li>???</li>
<li>Profit!</li>
</ol>
<button onclick="toggleEnabledDisabled()">Toggle Enabled / Disabled</button>
<div id="enabledDisabled" style="color:red; font-weight:bold">&nbsp;</div>
<div id="eventOutput">&nbsp;</div>
</div>
<div id="dragEnterOutput">&nbsp;</div>
<div id="dragOverOutput">&nbsp;</div>
<div id="dragLeaveOutput">&nbsp;</div>
<div id="dropOutput">&nbsp;</div>

<script type="text/javascript" src="../../sdk/gears_init.js"></script>
<script type="text/javascript">
var dragEnterCount = 0;
var dragOverCount = 0;
var dragLeaveCount = 0;
var dropCount = 0;
var eventCount = 0;

var dropZone = document.getElementById('dropZone');
var desktop = google.gears.factory.create('beta.desktop');
var dropTargetRegistration = null;

function updateEventOutput(event) {
  document.getElementById('eventOutput').innerHTML =
      'clientX: ' + event.clientX + ', ' + 'clientY: ' + event.clientY;
}

function toggleEnabledDisabled() {
  if (dropTargetRegistration) {
    document.getElementById('enabledDisabled').innerHTML =
        'Drag and Drop is disabled.';
    dropTargetRegistration.unregisterDropTarget();
    dropTargetRegistration = null;
  } else {
    document.getElementById('enabledDisabled').innerHTML = '&nbsp;';
    dropTargetRegistration = desktop.registerDropTarget(dropZone, {
      'debug': true,
      'ondragenter': function(context) {
        dragEnterCount++;
        eventCount++;
        updateEventOutput(context.event);
        document.getElementById('dragEnterOutput').innerHTML =
            'Got <b>dragenter</b>: ' + dragEnterCount +
                ' times, most recent sequence number is ' + eventCount;
      },
      'ondragover': function(context) {
        dragOverCount++;
        eventCount++;
        updateEventOutput(context.event);
        document.getElementById('dragOverOutput').innerHTML =
            'Got <b>dragover</b>: ' + dragOverCount +
                ' times, most recent sequence number is ' +  eventCount;
      },
      'ondragleave': function(context) {
        dragLeaveCount++;
        eventCount++;
        updateEventOutput(context.event);
        document.getElementById('dragLeaveOutput').innerHTML =
            'Got <b>dragleave</b>: ' + dragLeaveCount +
                ' times, most recent sequence number is ' +  eventCount;
      },
      'ondrop': function(context) {
        dropCount++;
        eventCount++;
        updateEventOutput(context.event);
        var s = 'Got <b>drop</b>: ' + dropCount +
            ' times, most recent sequence number is ' +  eventCount + '<hr/>';
        for (i = 0; i < context.files.length; i++) {
          var file = context.files[i];
          s += '<b>' + file.name + '</b> has length <b>' +
              file.blob.length + '</b>.<br/>';
        }
        document.getElementById('dropOutput').innerHTML = s;
      }
    });
  }
}
toggleEnabledDisabled();
</script>
</body>
</html>
