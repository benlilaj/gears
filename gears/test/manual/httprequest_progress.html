<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <title>HttpRequest progress</title>
    <script type="text/javascript" src="../../sdk/gears_init.js"></script>
    <script type="text/javascript" language="javascript">

function onSelect(files) {
  if (files.length == 0) {
    return;
  }
  var file = files[0];

  var request = google.gears.factory.create('beta.httprequest');
  function handleUploadReadyState() {
    document.getElementById("fileReady").innerHTML = request.readyState;
    document.getElementById("fileStatus").innerHTML = request.status;
  }
  function handleUploadProgress(event) {
    document.getElementById("fileProgress").innerHTML = event.loaded;
    document.getElementById("fileTotal").innerHTML = event.total;
  }


  document.getElementById("fileProgress").innerHTML = "<br/>";
  document.getElementById("fileTotal").innerHTML = "<br/>";
  document.getElementById("fileReady").innerHTML = "<br/>";
  document.getElementById("fileStatus").innerHTML = "<br/>";

  request.onreadystatechange = handleUploadReadyState;
  request.upload.onprogress = handleUploadProgress;
  request.open('POST', 'testcases/cgi/send_response_of_size.py?size=5');
  request.send(file.blob);
}

function testFileUpload() {
  var desktop = google.gears.factory.create('beta.desktop');
  desktop.openFiles(onSelect, {singleFile: true});
}

function testUploadProgress() {
  var request = google.gears.factory.create('beta.httprequest');
  function handleUploadReadyState() {
    document.getElementById("uploadReady").innerHTML = request.readyState;
    document.getElementById("uploadStatus").innerHTML = request.status;
  }
  function handleUploadProgress(event) {
    document.getElementById("uploadProgress").innerHTML = event.loaded;
    document.getElementById("uploadTotal").innerHTML = event.total;
  }


  document.getElementById("uploadProgress").innerHTML = "<br/>";
  document.getElementById("uploadTotal").innerHTML = "<br/>";
  document.getElementById("uploadReady").innerHTML = "<br/>";
  document.getElementById("uploadStatus").innerHTML = "<br/>";

  var data = 'fred';
  do {
    data = data + data;
  } while (data.length < 30000000);

  request.onreadystatechange = handleUploadReadyState;
  request.upload.onprogress = handleUploadProgress;
  request.open('POST', 'testcases/cgi/send_response_of_size.py?size=5');
  request.send(data);
}

function testDownloadProgress() {
  var request = google.gears.factory.create('beta.httprequest');
  function handleDownloadReadyState() {
    document.getElementById("downloadReady").innerHTML = request.readyState;
    document.getElementById("downloadStatus").innerHTML = request.status;
  }
  function handleDownloadProgress(event) {
    document.getElementById("downloadProgress").innerHTML = event.loaded;
    document.getElementById("downloadTotal").innerHTML = event.total;
  }


  document.getElementById("downloadProgress").innerHTML = "<br/>";
  document.getElementById("downloadTotal").innerHTML = "<br/>";
  document.getElementById("downloadReady").innerHTML = "<br/>";
  document.getElementById("downloadStatus").innerHTML = "<br/>";


  request.onreadystatechange = handleDownloadReadyState;
  request.onprogress = handleDownloadProgress;
  request.open('GET', 'testcases/cgi/send_response_of_size.py?size=33554432');
  request.send();
}
    </script>
  </head>
  <body>
    <h1>HttpRequest progress</h1>
    <table border="1">
      <tr>
        <td>type</td>
        <td>bytes transferred</td>
        <td>total bytes</td>
        <td>ready state</td>
        <td>status code</td>
      </tr>
      <tr>
        <td>
          <form action="">
            <input type="button" value="TestDownloadProgress"
            onclick="testDownloadProgress()">
          </form>
        </td>
        <td><div id="downloadProgress"><br/></div></td>
        <td><div id="downloadTotal"><br/></div></td>
        <td><div id="downloadReady"><br/></div></td>
        <td><div id="downloadStatus"><br/></div></td>
      </tr>
      <tr>
        <td>
          <form action="">
            <input type="button" value="TestUploadProgress"
            onclick="testUploadProgress()">
          </form>
        </td>
        <td><div id="uploadProgress"><br/></div></td>
        <td><div id="uploadTotal"><br/></div></td>
        <td><div id="uploadReady"><br/></div></td>
        <td><div id="uploadStatus"><br/></div></td>
      </tr>
      <tr>
        <td>
          <form action="">
            <input type="button" value="TestFileUpload"
            onclick="testFileUpload()">
          </form>
        </td>
        <td><div id="fileProgress"><br/></div></td>
        <td><div id="fileTotal"><br/></div></td>
        <td><div id="fileReady"><br/></div></td>
        <td><div id="fileStatus"><br/></div></td>
      </tr>
    </table>

  </body>
</html>
